<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Matrix Training</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/handsontable/12.3.1/handsontable.full.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handsontable/12.3.1/handsontable.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: 16px;
        }
        
        .round-indicator {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        .risk-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .risk-list h2 {
            color: #333;
            margin-bottom: 12px;
            font-size: 18px;
        }
        
        .risk-item {
            background: white;
            padding: 8px 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 3px solid #667eea;
            font-size: 13px;
        }
        
        .risk-item.dragging {
            opacity: 0.5;
        }
        
        .risk-id {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 3px;
            font-size: 12px;
        }
        
        .matrix-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        
        .matrix-container h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        #hot-container {
            margin-bottom: 15px;
        }
        
        .legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 4px;
        }
        
        .controls {
            text-align: center;
            margin-top: 25px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .results {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }
        
        .results.show {
            display: block;
        }
        
        .results.success {
            background: #d4edda;
            border: 2px solid #28a745;
        }
        
        .results.warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }
        
        .results.danger {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }
        
        .results h3 {
            margin-bottom: 15px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .result-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .result-card.correct {
            border-left-color: #28a745;
        }
        
        .result-card.incorrect {
            border-left-color: #dc3545;
        }
        
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .instructions h3 {
            color: #1976d2;
            margin-bottom: 8px;
        }
        
        .instructions p {
            color: #555;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèóÔ∏è Construction Risk Matrix Training</h1>
        <p class="subtitle">Apartment Building Construction Project</p>
        
        <div class="round-indicator" id="roundIndicator">Round 1 of 2</div>
        
        <div class="instructions">
            <h3>üìã Instructions</h3>
            <p>Review the project risks below and place each risk in the appropriate cell of the risk matrix by typing the Risk ID (e.g., R1, R2) into the matrix cells. Consider both the <strong>Likelihood</strong> (how often it might occur) and <strong>Impact</strong> (how severe the consequences would be). Click Submit when ready!</p>
        </div>
        
        <div class="content-grid">
            <div class="risk-list">
                <h2>üìä Project Risks</h2>
                <div id="risksList"></div>
            </div>
            
            <div class="matrix-container">
                <h2>üéØ Risk Matrix</h2>
                <div id="hot-container"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #d4edda;"></div>
                        <span>Low Risk</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #fff3cd;"></div>
                        <span>Medium Risk</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffe5cc;"></div>
                        <span>High Risk</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f8d7da;"></div>
                        <span>Critical Risk</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="submitBtn" onclick="submitAssessment()">Submit Assessment</button>
            <button id="resetBtn" onclick="resetMatrix()" style="background: #6c757d; margin-left: 10px;">Reset Matrix</button>
        </div>
        
        <div class="results" id="results"></div>
    </div>

    <script>
        // Risk data for Round 1
        const round1Risks = [
            { id: 'R1', description: 'Minor delay in material delivery', correct: [4, 1] }, // Low likelihood, low impact
            { id: 'R2', description: 'Structural engineer unavailable for critical review', correct: [2, 3] }, // Medium likelihood, high impact
            { id: 'R3', description: 'Concrete curing issues in winter weather', correct: [3, 2] }, // High likelihood, medium impact
            { id: 'R4', description: 'Crane operator calls in sick', correct: [3, 1] }, // High likelihood, low impact
            { id: 'R5', description: 'Foundation excavation reveals contaminated soil', correct: [1, 4] }, // Low likelihood, catastrophic impact
            { id: 'R6', description: 'Building code changes during construction', correct: [2, 2] }, // Medium likelihood, medium impact
            { id: 'R7', description: 'Elevator installation delays', correct: [2, 2] }, // Medium likelihood, medium impact
            { id: 'R8', description: 'Major structural collapse during construction', correct: [1, 4] }, // Low likelihood, catastrophic impact
        ];

        // Risk data for Round 2 (consequences of poor Round 1)
        const round2Risks = [
            { id: 'R9', description: 'Budget overrun due to previous delays', correct: [4, 3] }, // High likelihood, high impact
            { id: 'R10', description: 'Investor threatens to pull funding', correct: [3, 4] }, // Medium likelihood, catastrophic impact
            { id: 'R11', description: 'Construction crew morale issues', correct: [4, 2] }, // High likelihood, medium impact
            { id: 'R12', description: 'Regulatory compliance violation from rushed work', correct: [3, 3] }, // High likelihood, high impact
            { id: 'R13', description: 'Quality control failures in concrete pours', correct: [3, 3] }, // High likelihood, high impact
            { id: 'R14', description: 'Subcontractor disputes over payment', correct: [4, 2] }, // High likelihood, medium impact
            { id: 'R15', description: 'Safety inspection reveals major violations', correct: [2, 4] }, // Medium likelihood, catastrophic impact
        ];

        let currentRound = 1;
        let currentRisks = round1Risks;
        let hot;
        let round1Score = 0;
        let userAnswers = {};

        // Initialize Handsontable
        function initMatrix() {
            const container = document.getElementById('hot-container');
            
            hot = new Handsontable(container, {
                data: [
                    ['', '', '', '', ''],
                    ['', '', '', '', ''],
                    ['', '', '', '', ''],
                    ['', '', '', '', ''],
                    ['', '', '', '', '']
                ],
                rowHeaders: ['Catastrophic', 'High', 'Medium', 'Low', 'Negligible'],
                colHeaders: ['Very Unlikely', 'Unlikely', 'Possible', 'Likely', 'Almost Certain'],
                width: '100%',
                height: 400,
                licenseKey: 'non-commercial-and-evaluation',
                cells: function(row, col) {
                    const cellProperties = {};
                    
                    // Color coding based on risk level
                    if ((row === 0 && col >= 2) || (row === 1 && col >= 3) || (row <= 1 && col === 4)) {
                        cellProperties.className = 'critical-risk';
                        cellProperties.renderer = criticalRenderer;
                    } else if ((row === 0 && col >= 1) || (row === 1 && col >= 2) || (row === 2 && col >= 3)) {
                        cellProperties.className = 'high-risk';
                        cellProperties.renderer = highRenderer;
                    } else if ((row === 2 && col >= 1) || (row === 3 && col >= 2)) {
                        cellProperties.className = 'medium-risk';
                        cellProperties.renderer = mediumRenderer;
                    } else {
                        cellProperties.className = 'low-risk';
                        cellProperties.renderer = lowRenderer;
                    }
                    
                    return cellProperties;
                }
            });
        }

        // Custom renderers for different risk levels
        function criticalRenderer(instance, td, row, col, prop, value, cellProperties) {
            Handsontable.renderers.TextRenderer.apply(this, arguments);
            td.style.background = '#f8d7da';
            td.style.fontWeight = 'bold';
        }

        function highRenderer(instance, td, row, col, prop, value, cellProperties) {
            Handsontable.renderers.TextRenderer.apply(this, arguments);
            td.style.background = '#ffe5cc';
            td.style.fontWeight = 'bold';
        }

        function mediumRenderer(instance, td, row, col, prop, value, cellProperties) {
            Handsontable.renderers.TextRenderer.apply(this, arguments);
            td.style.background = '#fff3cd';
        }

        function lowRenderer(instance, td, row, col, prop, value, cellProperties) {
            Handsontable.renderers.TextRenderer.apply(this, arguments);
            td.style.background = '#d4edda';
        }

        // Display risks
        function displayRisks() {
            const risksList = document.getElementById('risksList');
            risksList.innerHTML = '';
            
            currentRisks.forEach(risk => {
                const riskItem = document.createElement('div');
                riskItem.className = 'risk-item';
                riskItem.innerHTML = `
                    <div class="risk-id">${risk.id}</div>
                    <div>${risk.description}</div>
                `;
                risksList.appendChild(riskItem);
            });
        }

        // Submit assessment
        function submitAssessment() {
            const data = hot.getData();
            userAnswers = {};
            
            // Extract user answers
            for (let row = 0; row < data.length; row++) {
                for (let col = 0; col < data[row].length; col++) {
                    if (data[row][col]) {
                        const riskIds = data[row][col].split(',').map(id => id.trim().toUpperCase());
                        riskIds.forEach(riskId => {
                            if (riskId) {
                                userAnswers[riskId] = [row, col];
                            }
                        });
                    }
                }
            }
            
            // Check answers
            let correct = 0;
            let total = currentRisks.length;
            const feedback = [];
            
            const impactLabels = ['Catastrophic', 'High', 'Medium', 'Low', 'Negligible'];
            const likelihoodLabels = ['Very Unlikely', 'Unlikely', 'Possible', 'Likely', 'Almost Certain'];
            
            currentRisks.forEach(risk => {
                const userAnswer = userAnswers[risk.id];
                const isCorrect = userAnswer && userAnswer[0] === risk.correct[0] && userAnswer[1] === risk.correct[1];
                
                if (isCorrect) {
                    correct++;
                }
                
                feedback.push({
                    id: risk.id,
                    description: risk.description,
                    correct: isCorrect,
                    userAnswer: userAnswer ? `${likelihoodLabels[userAnswer[1]]}, ${impactLabels[userAnswer[0]]}` : 'Not placed',
                    correctAnswer: `${likelihoodLabels[risk.correct[1]]}, ${impactLabels[risk.correct[0]]}`
                });
            });
            
            const percentage = Math.round((correct / total) * 100);
            
            if (currentRound === 1) {
                round1Score = percentage;
                displayResults(percentage, feedback, true);
            } else {
                displayResults(percentage, feedback, false);
            }
        }

        // Display results
        function displayResults(percentage, feedback, isRound1) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.className = 'results show';
            
            if (percentage >= 80) {
                resultsDiv.classList.add('success');
            } else if (percentage >= 60) {
                resultsDiv.classList.add('warning');
            } else {
                resultsDiv.classList.add('danger');
            }
            
            let message = '';
            if (isRound1) {
                if (percentage >= 80) {
                    message = `<h3>üéâ Excellent Work! (${percentage}%)</h3>
                              <p>Your risk assessment was highly accurate. The project proceeds smoothly with minimal issues. However, let's see how you handle some follow-up challenges...</p>`;
                } else if (percentage >= 60) {
                    message = `<h3>‚ö†Ô∏è Decent Attempt (${percentage}%)</h3>
                              <p>Your assessment had some gaps. The project encountered several complications due to overlooked risks. Now you must manage the consequences...</p>`;
                } else {
                    message = `<h3>‚ùå Critical Gaps in Assessment (${percentage}%)</h3>
                              <p>Your risk assessment missed key threats. The project has suffered significant setbacks. You now face serious challenges that require immediate attention...</p>`;
                }
            } else {
                const totalScore = Math.round((round1Score + percentage) / 2);
                message = `<h3>üìä Final Results</h3>
                          <p><strong>Round 1 Score:</strong> ${round1Score}%</p>
                          <p><strong>Round 2 Score:</strong> ${percentage}%</p>
                          <p><strong>Overall Score:</strong> ${totalScore}%</p>
                          <p>${totalScore >= 75 ? 'üéâ Project Success! You managed risks effectively throughout the project lifecycle.' : 
                               totalScore >= 60 ? '‚ö†Ô∏è Project Completed with Issues. Better risk management could have prevented some problems.' : 
                               '‚ùå Project in Trouble. Critical risk management failures led to major project challenges.'}</p>`;
            }
            
            resultsDiv.innerHTML = message;
            
            // Add detailed feedback
            const resultsGrid = document.createElement('div');
            resultsGrid.className = 'results-grid';
            
            feedback.forEach(item => {
                const card = document.createElement('div');
                card.className = `result-card ${item.correct ? 'correct' : 'incorrect'}`;
                card.innerHTML = `
                    <div class="risk-id">${item.id}</div>
                    <div style="font-size: 14px; margin-bottom: 8px;">${item.description}</div>
                    <div style="font-size: 12px; color: #666;">
                        <strong>Your answer:</strong> ${item.userAnswer}<br>
                        <strong>Correct:</strong> ${item.correctAnswer}
                    </div>
                `;
                resultsGrid.appendChild(card);
            });
            
            resultsDiv.appendChild(resultsGrid);
            
            // Update button for next round
            if (isRound1) {
                document.getElementById('submitBtn').textContent = 'Continue to Round 2';
                document.getElementById('submitBtn').onclick = startRound2;
            } else {
                document.getElementById('submitBtn').textContent = 'Start Over';
                document.getElementById('submitBtn').onclick = resetGame;
            }
        }

        // Start Round 2
        function startRound2() {
            currentRound = 2;
            currentRisks = round2Risks;
            document.getElementById('roundIndicator').textContent = 'Round 2 of 2 - Managing Consequences';
            
            displayRisks();
            resetMatrix();
            
            document.getElementById('results').classList.remove('show');
            document.getElementById('submitBtn').textContent = 'Submit Final Assessment';
            document.getElementById('submitBtn').onclick = submitAssessment;
        }

        // Reset matrix
        function resetMatrix() {
            hot.loadData([
                ['', '', '', '', ''],
                ['', '', '', '', ''],
                ['', '', '', '', ''],
                ['', '', '', '', ''],
                ['', '', '', '', '']
            ]);
        }

        // Reset entire game
        function resetGame() {
            currentRound = 1;
            currentRisks = round1Risks;
            round1Score = 0;
            document.getElementById('roundIndicator').textContent = 'Round 1 of 2';
            displayRisks();
            resetMatrix();
            document.getElementById('results').classList.remove('show');
            document.getElementById('submitBtn').textContent = 'Submit Assessment';
            document.getElementById('submitBtn').onclick = submitAssessment;
        }

        // Initialize on load
        window.onload = function() {
            initMatrix();
            displayRisks();
        };
    </script>
</body>
</html>