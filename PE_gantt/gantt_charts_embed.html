<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <title>Critical Path Explorer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      font-family: "IBM Plex Sans", sans-serif;
      --blue: #4353A3;
      --teal: #5DC8B9;
      --red: #ef4444;
      --indigo: #6366f1;
    }

    body {
      background-color: #f9fafb;
      color: #111827;
      padding: 2rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: var(--blue);
    }

    .subtitle {
      color: #6b7280;
      margin-bottom: 2rem;
      font-size: 0.95rem;
    }

    .project-selector {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .project-btn {
      padding: 0.75rem 1.5rem;
      border: 2px solid #e5e7eb;
      background: white;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .project-btn:hover {
      border-color: var(--teal);
    }

    .project-btn.active {
      background: var(--blue);
      color: white;
      border-color: var(--blue);
    }

    .chart-section {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .chart-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .duration {
      color: #6b7280;
      font-size: 0.9rem;
    }

    .duration strong {
      color: #111827;
      font-weight: 600;
    }

    .scale-header {
      display: grid;
      margin-left: 24px;
      margin-bottom: 0.5rem;
    }

    .scale-label {
      text-align: center;
      font-size: 0.75rem;
      color: #6b7280;
    }

    .chart-area {
      position: relative;
      margin-top: 1rem;
    }

    .task-row {
      position: absolute;
      left: 0;
      height: 130px;
    }

    .task-bar {
      position: relative;
      height: 110px;
      border-radius: 0.75rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: grab;
      transition: transform 0.1s;
      min-width: 100px !important;
          z-index: 10;
    }

    .task-bar:active {
      cursor: grabbing;
    }

    .task-bar.critical {
      background: var(--red);
      color: white;
    }

    .task-bar.non-critical {
      background: var(--indigo);
      color: white;
    }

    .task-content {
      text-align: center;
      pointer-events: none;
    }

    .task-name {
      font-weight: 500;
      font-size: 0.9rem;
    }

    .task-info {
      font-size: 0.75rem;
      opacity: 0.9;
      margin-top: 0.25rem;
    }

    .corner-value {
      position: absolute;
      font-size: 0.65rem;
      background: rgba(255,255,255,0.3);
      padding: 0.15rem 0.35rem;
      border-radius: 0.25rem;
    }

    .es { top: 0.25rem; left: 0.25rem; }
    .ef { top: 0.25rem; right: 0.25rem; }
    .ls { bottom: 0.25rem; left: 0.25rem; }
    .lf { bottom: 0.25rem; right: 0.25rem; }

    .arrows-svg {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .legend {
      display: flex;
      gap: 2rem;
      align-items: center;
      padding: 1rem;
      background: #f9fafb;
      border-radius: 0.5rem;
      font-size: 0.9rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .legend-box {
      width: 1rem;
      height: 1rem;
      border-radius: 0.25rem;
    }

    .instructions {
      background: #eff6ff;
      border-left: 4px solid var(--blue);
      padding: 2rem;
      border-radius: 0.5rem;
      margin-bottom: 2rem;
    }

    .instructions h3 {
      font-size: 1rem;
      margin-bottom: 0.5rem;
      color: var(--blue);
    }

    .instructions ul {
      margin-left: 1.5rem;
      color: #374151;
      font-size: 0.9rem;
    }

    .instructions li {
      margin-bottom: 0.5rem;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal {
      background: white;
      border-radius: 1rem;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--blue);
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      transition: background 0.2s;
    }

    .close-btn:hover {
      background: #f3f4f6;
    }

    .modal-section {
      margin-bottom: 1.5rem;
    }

    .modal-section-title {
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #374151;
    }

    .dependency-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .dependency-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: #f9fafb;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    .dependency-item:hover {
      background: #f3f4f6;
    }

    .checkbox {
      width: 1.25rem;
      height: 1.25rem;
      cursor: pointer;
    }

    .dependency-info {
      flex: 1;
    }

    .dependency-name {
      font-weight: 500;
      color: #111827;
    }

    .dependency-duration {
      font-size: 0.85rem;
      color: #6b7280;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e5e7eb;
    }

    .modal-btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-btn-primary {
      background: var(--blue);
      color: white;
    }

    .modal-btn-primary:hover {
      background: #3a4785;
    }

    .modal-btn-secondary {
      background: #f3f4f6;
      color: #374151;
    }

    .modal-btn-secondary:hover {
      background: #e5e7eb;
    }

    .compare-modal {
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .model-answer-image {
      width: 100%;
      height: auto;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .modal-feedback {
      margin: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="instructions">
      <h3>How to use:</h3>
      <ul>
        <li>Drag any task bar left or right to change its start time</li>
        <li>Click on a task to edit its dependencies</li>
        <li>Watch how the critical path (red tasks) changes as you move tasks beyond their slack</li>
        <li>Moving a critical path task will shift dependent tasks and may extend the project deadline</li>
      </ul>
    </div>

    <div class="project-selector" id="project-selector"></div>

    <div class="chart-section">
      <div class="chart-header">
        <h2 class="chart-title" id="project-name"></h2>
        <div style="display: flex; gap: 2rem; align-items: center;">
          <div class="duration">Duration: <strong id="duration">0</strong> days</div>
          <div class="duration">Ideal Duration: <strong id="ideal-duration">0</strong> days</div>
        </div>
      </div>

      <div class="scale-header" id="scale-header"></div>
      
      <div class="chart-area" id="chart-area">
        <div id="task-bars"></div>
        <svg class="arrows-svg" id="arrows-svg">
          <defs>
            <marker id="arrow-gray" markerWidth="8" markerHeight="8" refX="8" refY="4" orient="auto">
              <path d="M0,0 L8,4 L0,8 Z" fill="#9ca3af" />
            </marker>
            <marker id="arrow-red" markerWidth="8" markerHeight="8" refX="8" refY="4" orient="auto">
              <path d="M0,0 L8,4 L0,8 Z" fill="#ef4444" />
            </marker>
          </defs>
          <g id="arrow-paths"></g>
        </svg>
      </div>

      <div class="legend">
        <div class="legend-item">
          <div class="legend-box" style="background: var(--red);"></div>
          <span>Critical Path</span>
        </div>
        <div class="legend-item">
          <div class="legend-box" style="background: var(--indigo);"></div>
          <span>Non-Critical (has slack)</span>
        </div>
        <div>Slack = LS - ES</div>
      </div>
    </div>

    <div style="display: flex; justify-content: center; margin-top: 1rem;">
      <button class="modal-btn modal-btn-primary" id="compare-btn">Compare with Model Answer</button>
     <!--<button class="modal-btn modal-btn-primary" id="reset-btn">Reset projects</button>-->
    </div>
  </div>

  <div id="modal-container"></div>

  <script>
    const PROJECTS = [
      {
        id: 1,
        name: "Website Development",
        modelAnswerImage: "website-development-answer.png",
        idealDuration: 12, // Static ideal duration
        feedback: "In this model answer, the project duration is 12 units. This is achieved by staggering some of the tasks, as development of the site can begin on a basic level before the whole website design is finalised. Similarly, the content doesn't need to be completely finalised for basic code development to begin. <br> If this Gantt chart was more detailed, there would be individual tasks within each of these larger tasks including milestones such as 'Website structure design approved', at which point basic development can begin. As a project manager, your ability to identify these situations can help introduce slack into otherwise very tight deadlines, or create more time for review and fine tuning by having all resources utilised concurrently.",
        tasks: [
          { id: "A", name: "Planning", duration: 3, deps: [] },
          { id: "B", name: "Design", duration: 4, deps: ["A"] },
          { id: "C", name: "Content", duration: 3, deps: ["A"] },
          { id: "D", name: "Development", duration: 5, deps: ["B", "C"] },
          { id: "E", name: "Testing", duration: 3, deps: ["D"] }
        ]
      },
      {
        id: 2,
        name: "Event Planning",
        modelAnswerImage: "event-planning-answer.png",
        idealDuration: 12, // Static ideal duration
        feedback:"In this chart, the project duration here is reduced by identifying that catering is not a required prerequisite for the decorations to be purchased. The venue will impact which decorations are needed or suitable, but the catering is unlikely to.",
        tasks: [
          { id: "A", name: "Confirm attendees", duration: 2, deps: [] },
          { id: "B", name: "Book venue", duration: 4, deps: ["A"] },
         { id: "C", name: "Book catering", duration: 2, deps: ["B"] },
          { id: "D", name: "Purchase decorations", duration: 3, deps: ["B", "C"] },
          { id: "E", name: "Setup Plan", duration: 2, deps: ["B", "C", "D"] },
          { id: "F", name: "Final Check", duration: 1, deps: ["E"] }
        ]
      },
      {
        id: 3,
        name: "Garden renovation",
        modelAnswerImage: "garden-renovation-answer.png",
        idealDuration: 14, // Static ideal duration
        feedback:"In this Gantt chart, the renovation timeline is reduced to 14 days by correctly identifying the critical tasks based on dependencies. The survey of the soil quality, the process of improving the soil quality, and the planting of the garden beds form the critical path.",
        tasks: [
          { id: "A", name: "Survey existing garden and soil quality", duration: 4, deps: [] },
          { id: "B", name: "Remove decking", duration: 2, deps: ["A"] },
          { id: "C", name: "Improve soil quality", duration: 7, deps: ["B", "A"] },
          { id: "D", name: "Order plants and materials", duration: 3, deps: ["C", "A"] },
          { id: "E", name: "Build new decking", duration: 3, deps: ["D" , "B"] },
          { id: "F", name: "Plant garden beds", duration: 3, deps: ["E", "C", "D"] }
        ]
      }
    ];

    const state = {
      currentProjectId: 1,
      minStart: {},
      dragging: null,
      unitWidth: 40,
      clickStartTime: 0,
      clickStartPos: { x: 0, y: 0 }
    };

    function getCurrentProject() {
      return PROJECTS.find(p => p.id === state.currentProjectId);
    }

    function computeCPM(tasks, minStart = {}) {
      const ES = {}, EF = {}, LS = {}, LF = {};
      const byId = {};
      tasks.forEach(t => byId[t.id] = t);

      const indeg = {};
      const graph = {};
      tasks.forEach(t => {
        indeg[t.id] = t.deps.length;
        t.deps.forEach(d => {
          graph[d] = graph[d] || [];
          graph[d].push(t.id);
        });
      });

      const queue = tasks.filter(t => indeg[t.id] === 0).map(t => t.id);
      const order = [];

      while (queue.length) {
        const u = queue.shift();
        order.push(u);
        (graph[u] || []).forEach(v => {
          indeg[v]--;
          if (indeg[v] === 0) queue.push(v);
        });
      }

      for (const id of order) {
        const t = byId[id];
        const predEF = t.deps.length ? Math.max(...t.deps.map(p => EF[p])) : 0;
        ES[id] = Math.max(predEF, minStart[id] || 0);
        EF[id] = ES[id] + t.duration;
      }

      const projectDuration = Math.max(...Object.values(EF));

      const succs = {};
      tasks.forEach(t => t.deps.forEach(d => {
        succs[d] = succs[d] || [];
        succs[d].push(t.id);
      }));

      for (const id of [...order].reverse()) {
        const t = byId[id];
        const s = succs[id] || [];
        LF[id] = s.length === 0 ? projectDuration : Math.min(...s.map(v => LS[v]));
        LS[id] = LF[id] - t.duration;
      }

      const slack = {};
      const critical = new Set();
      tasks.forEach(t => {
        slack[t.id] = LS[t.id] - ES[t.id];
        if (Math.abs(slack[t.id]) < 0.01) critical.add(t.id);
      });

      return { ES, EF, LS, LF, slack, critical, projectDuration };
    }

    function render() {
      const project = getCurrentProject();
      const computed = computeCPM(project.tasks, state.minStart);
      const maxTime = Math.ceil(computed.projectDuration * 1.2);

      document.getElementById('project-name').textContent = project.name;
      document.getElementById('duration').textContent = computed.projectDuration;
      document.getElementById('ideal-duration').textContent = project.idealDuration; // Use static ideal duration

      renderScale(maxTime);
      renderTasks(project, computed, maxTime);
      renderArrows(project, computed, maxTime);
    }

    function renderScale(maxTime) {
      const scale = document.getElementById('scale-header');
      const cols = Math.ceil(maxTime) + 1;
      scale.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      scale.innerHTML = '';
      
      for (let i = 0; i <= maxTime; i++) {
        const label = document.createElement('div');
        label.className = 'scale-label';
        label.textContent = i;
        scale.appendChild(label);
      }
    }

    function renderTasks(project, computed, maxTime) {
      const container = document.getElementById('task-bars');
      const chartArea = document.getElementById('chart-area');
      
      container.innerHTML = '';
      chartArea.style.height = (project.tasks.length * 120 + 50) + 'px';

      const chartWidth = document.getElementById('scale-header').offsetWidth;
      state.unitWidth = chartWidth / (maxTime + 1);

      project.tasks.forEach((task, idx) => {
        const start = state.minStart[task.id] ?? computed.ES[task.id];
        const isCritical = computed.critical.has(task.id);

        const row = document.createElement('div');
        row.className = 'task-row';
        row.style.top = (idx * 120) + 'px';

        const bar = document.createElement('div');
        bar.className = `task-bar ${isCritical ? 'critical' : 'non-critical'}`;
        bar.style.left = (24 + start * state.unitWidth) + 'px';
        bar.style.width = (task.duration * state.unitWidth) + 'px';
        bar.dataset.taskId = task.id;

        bar.innerHTML = `
          <div class="task-content">
            <div class="task-name">${task.id}: ${task.name}</div>
            <div class="task-info">Duration: ${task.duration} | Slack: ${computed.slack[task.id].toFixed(0)}</div>
          </div>
          <div class="corner-value es">ES: ${computed.ES[task.id]}</div>
          <div class="corner-value ef">EF: ${computed.EF[task.id]}</div>
          <div class="corner-value ls">LS: ${computed.LS[task.id]}</div>
          <div class="corner-value lf">LF: ${computed.LF[task.id]}</div>
        `;

        bar.addEventListener('mousedown', handleMouseDown);
        row.appendChild(bar);
        container.appendChild(row);
      });
    }

    function renderArrows(project, computed, maxTime) {
      const svg = document.getElementById('arrows-svg');
      const paths = document.getElementById('arrow-paths');
      const chartWidth = 24 + (maxTime + 1) * state.unitWidth;
      const chartHeight = project.tasks.length * 120 + 20;

      svg.setAttribute('viewBox', `0 0 ${chartWidth} ${chartHeight}`);
      paths.innerHTML = '';

      project.tasks.forEach((task, tgtIdx) => {
        const tgtStart = state.minStart[task.id] ?? computed.ES[task.id];
        const tgtX = 24 + tgtStart * state.unitWidth;
        const tgtY = tgtIdx * 110 + 40;

        task.deps.forEach(depId => {
          const pred = project.tasks.find(t => t.id === depId);
          if (!pred) return;

          const predIdx = project.tasks.indexOf(pred);
          const predStart = state.minStart[pred.id] ?? computed.ES[pred.id];
          const predEnd = predStart + pred.duration;
          const predEndX = 24 + predEnd * state.unitWidth;
          const predY = predIdx * 110 + 40;

          const gap = tgtStart - predEnd;
          const hasGap = gap >= 1;

          const midX = (predEndX + tgtX) / 2;
          const isCritLink = computed.critical.has(depId) && computed.critical.has(task.id);
          
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          path.setAttribute('d', `M ${predEndX} ${predY} H ${midX} V ${tgtY} H ${tgtX}`);
          path.setAttribute('fill', 'none');
          path.setAttribute('stroke', isCritLink ? '#ef4444' : '#9ca3af');
          path.setAttribute('stroke-width', '2');
          
          if (hasGap) {
            path.setAttribute('marker-end', isCritLink ? 'url(#arrow-red)' : 'url(#arrow-gray)');
          }
          
          paths.appendChild(path);
        });
      });
    }

    function handleMouseDown(e) {
      const taskId = e.currentTarget.dataset.taskId;
      const project = getCurrentProject();
      const computed = computeCPM(project.tasks, state.minStart);
      const start = state.minStart[taskId] ?? computed.ES[taskId];

      state.clickStartTime = Date.now();
      state.clickStartPos = { x: e.clientX, y: e.clientY };

      state.dragging = {
        id: taskId,
        startX: e.clientX,
        origStart: start,
        hasMoved: false
      };
    }

    function handleMouseMove(e) {
      if (!state.dragging) return;

      const dx = Math.abs(e.clientX - state.clickStartPos.x);
      const dy = Math.abs(e.clientY - state.clickStartPos.y);
      
      if (dx > 5 || dy > 5) {
        state.dragging.hasMoved = true;
      }

      if (!state.dragging.hasMoved) return;

      const project = getCurrentProject();
      const task = project.tasks.find(t => t.id === state.dragging.id);
      
      let minAllowedStart = 0;
      if (task.deps.length > 0) {
        const computed = computeCPM(project.tasks, state.minStart);
        task.deps.forEach(depId => {
          const predTask = project.tasks.find(t => t.id === depId);
          if (predTask) {
            const predStart = state.minStart[depId] ?? computed.ES[depId];
            const predEnd = predStart + predTask.duration;
            minAllowedStart = Math.max(minAllowedStart, predEnd);
          }
        });
      }

      const deltaX = e.clientX - state.dragging.startX;
      const deltaUnits = Math.round(deltaX / state.unitWidth);
      const newStart = Math.max(minAllowedStart, state.dragging.origStart + deltaUnits);

      state.minStart[state.dragging.id] = newStart;
      render();
    }

    function handleMouseUp(e) {
      if (state.dragging && !state.dragging.hasMoved) {
        const timeSinceDown = Date.now() - state.clickStartTime;
        if (timeSinceDown < 300) {
          openDependencyModal(state.dragging.id);
        }
      }
      state.dragging = null;
    }

    function renderProjectSelector() {
      const container = document.getElementById('project-selector');
      container.innerHTML = '';

      PROJECTS.forEach(p => {
        const btn = document.createElement('button');
        btn.className = `project-btn ${p.id === state.currentProjectId ? 'active' : ''}`;
        btn.textContent = p.name;
        btn.onclick = () => {
          state.currentProjectId = p.id;
          state.minStart = {};
          renderProjectSelector();
          render();
        };
        container.appendChild(btn);
      });
    }

    function openDependencyModal(taskId) {
      const project = getCurrentProject();
      const task = project.tasks.find(t => t.id === taskId);
      if (!task) return;

      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal">
          <div class="modal-header">
            <h3 class="modal-title">Edit Dependencies: ${task.id} - ${task.name}</h3>
            <button class="close-btn">×</button>
          </div>
          
          <div class="modal-section">
            <div class="modal-section-title">Select Predecessor Tasks:</div>
            <div class="dependency-list" id="dependency-list"></div>
          </div>

          <div class="modal-footer">
            <button class="modal-btn modal-btn-secondary" id="cancel-btn">Cancel</button>
            <button class="modal-btn modal-btn-primary" id="save-btn">Save Changes</button>
          </div>
        </div>
      `;

      const depList = modal.querySelector('#dependency-list');
      const tempDeps = new Set(task.deps);

      project.tasks.forEach(t => {
        if (t.id === taskId) return;
        
        const wouldCreateCycle = (depId) => {
          const visited = new Set();
          const checkCycle = (id) => {
            if (id === taskId) return true;
            if (visited.has(id)) return false;
            visited.add(id);
            const depTask = project.tasks.find(dt => dt.id === id);
            return depTask?.deps.some(d => checkCycle(d));
          };
          return checkCycle(depId);
        };

        const isChecked = tempDeps.has(t.id);
        const wouldCycle = !isChecked && wouldCreateCycle(t.id);

        const item = document.createElement('div');
        item.className = 'dependency-item';
        if (wouldCycle) {
          item.style.opacity = '0.5';
          item.style.cursor = 'not-allowed';
        }
        
        item.innerHTML = `
          <input type="checkbox" class="checkbox" id="dep-${t.id}" ${isChecked ? 'checked' : ''} ${wouldCycle ? 'disabled' : ''}>
          <div class="dependency-info">
            <div class="dependency-name">${t.id}: ${t.name}</div>
            <div class="dependency-duration">Duration: ${t.duration} days${wouldCycle ? ' (would create cycle)' : ''}</div>
          </div>
        `;

        const checkbox = item.querySelector('.checkbox');
        if (!wouldCycle) {
          item.onclick = () => {
            checkbox.checked = !checkbox.checked;
            if (checkbox.checked) {
              tempDeps.add(t.id);
            } else {
              tempDeps.delete(t.id);
            }
          };
        }

        depList.appendChild(item);
      });

      modal.querySelector('.close-btn').onclick = () => modal.remove();
      modal.querySelector('#cancel-btn').onclick = () => modal.remove();
      modal.querySelector('#save-btn').onclick = () => {
        task.deps = Array.from(tempDeps);
        state.minStart = {};
        render();
        modal.remove();
      };

      modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
      };

      document.getElementById('modal-container').appendChild(modal);
    }

    function openCompareModal() {
      const project = getCurrentProject();

      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal compare-modal">
          <div class="modal-header">
            <h3 class="modal-title">Model Answer: ${project.name}</h3>
            <button class="close-btn">×</button>
          </div>
          <div class="modal-feedback">
            <p>Ideal duration: ${project.idealDuration}</p><br>
            <p>${project.feedback}</p>
            </div>
          <div style="margin-bottom: 1rem;">
            <img src="${project.modelAnswerImage}" alt="Model Answer for ${project.name}" class="model-answer-image" />
          </div>

          <div class="modal-footer">
            <button class="modal-btn modal-btn-secondary" id="close-compare-btn">Close</button>
          </div>
        </div>
      `;

      modal.querySelector('.close-btn').onclick = () => modal.remove();
      modal.querySelector('#close-compare-btn').onclick = () => modal.remove();
      modal.onclick = (e) => {
        if (e.target === modal) modal.remove();
      };

      document.getElementById('modal-container').appendChild(modal);
    }

    document.getElementById('compare-btn').onclick = openCompareModal;

    window.addEventListener('mousemove', handleMouseMove);
    window.addEventListener('mouseup', handleMouseUp);
    window.addEventListener('resize', render);

    renderProjectSelector();
    render();
  </script>
</body>
</html>