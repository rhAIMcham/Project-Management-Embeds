<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spreadsheet App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/handsontable/16.1.1/handsontable.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/handsontable/16.1.1/ht-theme-main.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .toolbar {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .spreadsheet-container {
            flex: 1;
            padding: 2rem;
            overflow: auto;
            background: white;
            margin: 1rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        #spreadsheet {
            height: 100%;
            min-height: 500px;
        }

        .info {
            padding: 0.5rem 1rem;
            background: #e8f4f8;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #0c5460;
        }

        input[type="file"] {
            display: none;
        }

        .file-label {
            background: #28a745;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .file-label:hover {
            background: #218838;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Excel-like Spreadsheet</h1>
        <p style="opacity: 0.9; font-size: 0.9rem;">Full-featured data grid with formulas, sorting, and filtering</p>
    </div>

    <div class="toolbar">
        <button class="btn" onclick="addRow()">‚ûï Add Row</button>
        <button class="btn" onclick="addColumn()">‚ûï Add Column</button>
        <button class="btn btn-danger" onclick="clearData()">üóëÔ∏è Clear All</button>
        <button class="btn btn-secondary" onclick="exportToCSV()">üíæ Export CSV</button>
        <label class="file-label" for="csvInput">üìÇ Import CSV</label>
        <input type="file" id="csvInput" accept=".csv" onchange="importCSV(event)">
        <button class="btn btn-success" onclick="fillSampleData()">üìù Sample Data</button>
        <div class="info">
            üí° Right-click for context menu ‚Ä¢ Double-click to edit ‚Ä¢ Use formulas like =SUM(A1:A5)
        </div>
    </div>

    <div class="spreadsheet-container">
        <div id="spreadsheet"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/handsontable/16.1.1/handsontable.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hyperformula/2.7.11/hyperformula.full.min.js"></script>
    <script>
        let hot;
        
        // Initialize Handsontable
        function initSpreadsheet() {
            const container = document.getElementById('spreadsheet');
            
            hot = new Handsontable(container, {
                data: createEmptyData(20, 10),
                rowHeaders: true,
                colHeaders: true,
                contextMenu: true,
                manualRowResize: true,
                manualColumnResize: true,
                manualRowMove: true,
                manualColumnMove: true,
                filters: true,
                dropdownMenu: true,
                columnSorting: true,
                autoWrapRow: true,
                autoWrapCol: true,
                stretchH: 'all',
                height: '100%',
                licenseKey: 'non-commercial-and-evaluation',
                themeName: 'ht-theme-main',
                formulas: {
                    engine: HyperFormula
                },
                cells: function(row, col) {
                    const cellProperties = {};
                    cellProperties.renderer = customRenderer;
                    return cellProperties;
                }
            });
        }

        // Custom cell renderer for better formatting
        function customRenderer(instance, td, row, col, prop, value, cellProperties) {
            Handsontable.renderers.TextRenderer.apply(this, arguments);
            
            if (value !== null && value !== undefined && value !== '') {
                // Number formatting
                if (typeof value === 'number') {
                    td.style.textAlign = 'right';
                    td.style.fontWeight = '500';
                }
                
                // Formula cells
                if (typeof value === 'string' && value.startsWith('=')) {
                    td.style.background = '#fff9e6';
                    td.style.fontFamily = 'monospace';
                }
            }
            
            return td;
        }

        // Create empty data array
        function createEmptyData(rows, cols) {
            const data = [];
            for (let i = 0; i < rows; i++) {
                data.push(new Array(cols).fill(''));
            }
            return data;
        }

        // Add a new row
        function addRow() {
            const rowCount = hot.countRows();
            hot.alter('insert_row_below', rowCount);
        }

        // Add a new column
        function addColumn() {
            const colCount = hot.countCols();
            hot.alter('insert_col_end', colCount);
        }

        // Clear all data
        function clearData() {
            if (confirm('Are you sure you want to clear all data?')) {
                hot.loadData(createEmptyData(20, 10));
            }
        }

        // Export to CSV
        function exportToCSV() {
            const exportPlugin = hot.getPlugin('exportFile');
            exportPlugin.downloadFile('csv', {
                filename: 'spreadsheet-export',
                columnHeaders: true,
                rowHeaders: false
            });
        }

        // Import CSV
        function importCSV(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const rows = text.split('\n').map(row => row.split(','));
                hot.loadData(rows);
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Fill with sample data
        function fillSampleData() {
            const sampleData = [
                ['Product', 'Q1 Sales', 'Q2 Sales', 'Q3 Sales', 'Q4 Sales', 'Total', 'Average'],
                ['Laptops', 1200, 1350, 1480, 1620, '=SUM(B2:E2)', '=AVERAGE(B2:E2)'],
                ['Tablets', 850, 920, 1050, 1100, '=SUM(B3:E3)', '=AVERAGE(B3:E3)'],
                ['Phones', 2100, 2250, 2400, 2650, '=SUM(B4:E4)', '=AVERAGE(B4:E4)'],
                ['Monitors', 650, 700, 720, 800, '=SUM(B5:E5)', '=AVERAGE(B5:E5)'],
                ['Keyboards', 340, 380, 420, 450, '=SUM(B6:E6)', '=AVERAGE(B6:E6)'],
                ['', '', '', '', '', '', ''],
                ['Total', '=SUM(B2:B6)', '=SUM(C2:C6)', '=SUM(D2:D6)', '=SUM(E2:E6)', '=SUM(F2:F6)', ''],
                ['', '', '', '', '', '', ''],
                ['Department', 'Budget', 'Spent', 'Remaining', '', '', ''],
                ['Marketing', 50000, 35000, '=B11-C11', '', '', ''],
                ['Sales', 75000, 62000, '=B12-C12', '', '', ''],
                ['IT', 40000, 28000, '=B13-C13', '', '', ''],
                ['HR', 30000, 22000, '=B14-C14', '', '', '']
            ];
            
            hot.loadData(sampleData);
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', initSpreadsheet);
    </script>
</body>
</html>